__Проверка файла конфигурации /etc/php8/fpm/php-fpm.conf__

```
sudo php-fpm -t
```

__Отобразить настройки php-fpm__

```
sudo php-fpm -tt
```

__Основные настройки конфигурационного файла___

_Пример настройки сервера ai-serv2t:_

Показывает состояние (статус) под процессов службы php-fpm
```
sudo systemctl status php-fpm.service -l
```
![[Снимок экрана от 2025-10-23 15-47-29.png]]

```
ps -AH -o pid,size,command | sort -rn -k2 | grep php-fpm
```
![[Снимок экрана от 2025-10-23 14-52-12.png]]

```
sudo python3 ps_mem.py
```
![[Снимок экрана от 2025-10-23 14-59-36.png]]

```
nproc
```
![[Снимок экрана от 2025-10-23 15-01-00.png]]

```
free -lh
```
![[Снимок экрана от 2025-10-23 15-19-53.png]]

>Для расчета возьмем среднее значение памяти для одного процесса php-fpm равное 50 Mb (это намного больше чем чем показывает выполнение команд ps и ps_mem.py). Так как я думаю это значение будет расти в процессе нагрузки и надо наблюдать. 

>Свободной памяти имеется 11 Gi. Оставим свободной (не задействованной) где то 3 Gi. Итого получаем: 11 - 3 = 8 Gi =  8192 Mb / 50 Mb = 163 процесса php-fpm. Это значение даже превышает то, которое задал Диман для пожаров (150 максимум процессов). Поэтому выполним настройки как на пожарах и будем наблюдать.

```
sudo vim /etc/php8/fpm/php-fpm.d/www.conf
```

```
pm = dynamic
[23-Oct-2025 15:33:01] NOTICE: 	pm.max_children = 150
[23-Oct-2025 15:33:01] NOTICE: 	pm.start_servers = 40
[23-Oct-2025 15:33:01] NOTICE: 	pm.min_spare_servers = 30
[23-Oct-2025 15:33:01] NOTICE: 	pm.max_spare_servers = 80
```
