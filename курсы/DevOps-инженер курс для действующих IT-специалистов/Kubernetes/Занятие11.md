### Задание. При деплое приложение web-consumer не может подключиться к auth-db. Необходимо это исправить

[ссылка на домашнее задание](https://github.com/netology-code/kuber-homeworks/blob/main/3.5/3.5.md#задание-при-деплое-приложение-web-consumer-не-может-подключиться-к-auth-db-необходимо-это-исправить)

1. Установить приложение по команде:

```shell
kubectl apply -f https://raw.githubusercontent.com/netology-code/kuber-homeworks/main/3.5/files/task.yaml
```

![[Снимок экрана от 2026-01-19 10-24-48.png]]

**Создаем namespace:**

```
kubectl create namespace web
```

```
kubectl create namespace data
```


```shell
kubectl apply -f https://raw.githubusercontent.com/netology-code/kuber-homeworks/main/3.5/files/task.yaml
```

![[Снимок экрана от 2026-01-19 10-26-26.png]]

2. Выявить проблему и описать.

```
kubectl -n web get deployments.apps -o wide
```

![[Снимок экрана от 2026-01-19 10-29-56.png]]

```
kubectl -n web get pods -o wide
```

![[Снимок экрана от 2026-01-19 10-30-23.png]]


> [!NOTE]
> Видим, что контейнеры не запустились

**Смотрим логи пода:**

```
kubectl -n web logs web-consumer-64fc486bdf-dnnpd
```

![[Снимок экрана от 2026-01-19 10-37-14.png]]


> [!NOTE] 
> Из логов видно, что образ не может быть загружен. Контейнер ожидает запуска.

**Проверим правильно ли указано название образа.**

```
cat task.yml
```

![[Снимок экрана от 2026-01-19 10-43-26.png]]

***Ищем image на Docker Hub и находим его. Соответственно проблема не в названии образа. ***

![[Снимок экрана от 2026-01-19 10-44-59.png]]

**Проверим вывод информации через describe**

```
kubectl -n web describe pods web-consumer-64fc486bdf-mwc7b
```

![[Снимок экрана от 2026-01-19 11-45-12.png]]


> [!NOTE]
> В выводе обращаем на ошибку, которая означает что ==образ был собран с использованием устаревшего формата манифеста **Docker Image Manifest V1**, который больше не поддерживается в современных версиях== containerd. Если посмотреть информацию об образе на сайте docker hub, то действительно можно увидеть что последняя версия образа была собрана 10 лет назад.

Есть два пути решения данной проблемы:

- **Использовать другой, более актуальный образ**
- **Пересобрать устаревший образ**

**Для решения проблемы выберем первый вариант, использовать другой образ например curlimages/curl:latest***

![[Снимок экрана от 2026-01-19 12-09-30.png]]

```
kubectl apply -f task.yaml
```

```
kubectl -n web get deployments.apps web-consumer -o wide
```

![[Снимок экрана от 2026-01-19 12-10-31.png]]

Видим что контейнеры запустились. Проверим логи подов.

```
kubectl -n web logs pods/web-consumer-86bf747999-9ggzn
```

![[Снимок экрана от 2026-01-19 12-12-13.png]]


> [!NOTE]
> Видим ошибку: curl: (6) Не удалось разрешить хост: auth-db

Данная ошибка вызвана тем, что deployment: web-consumer находится в другом namespace в отличии от deployment: auth-db и service: auth-db. Изменим namespace для deployment: web-consumer на data

![[Снимок экрана от 2026-01-19 12-18-03.png]]

```
kubectl -n data logs web-consumer-86bf747999-m8mzx
```

![[Снимок экрана от 2026-01-19 12-19-14.png]]

В итоге получаем ответ от auth-db.







