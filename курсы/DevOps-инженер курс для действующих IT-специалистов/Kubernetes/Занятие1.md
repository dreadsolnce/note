Список открытых портов:

```roff
sudo netstat -tlpn
```

![[Pasted image 20251213112016.png]]

Проверить статус microk8s:

```
microk8s status --wait-ready
```

![[Pasted image 20251213112038.png]]

Получить список нод:

```
microk8s kubectl get nodes
```
![[Pasted image 20251213112057.png]]
Установить addon dashboard

```roff
microk8s enable dashboard
```
![[Pasted image 20251213112109.png]]

Список addon:

```roff
microk8s status
```
![[Pasted image 20251213112123.png]]

Вывод конфигурации:

```roff
microk8s config
```
![[Pasted image 20251213112134.png]]

Настройка внешнего подключения

```roff
sudo vim /var/snap/microk8s/current/certs/csr.conf.template
```

```
# [ alt_names ]
# Add
# IP.3 = 10.128.0.11
# IP.4 = 89.169.153.13
```
![[Pasted image 20251213112213.png]]

Обновить сертификаты:

```roff
sudo microk8s refresh-certs --cert front-proxy-client.crt
```

![[Pasted image 20251213112319.png]]

Обновить корневой сертификат:

```roff
sudo microk8s refresh-certs -e ca.crt
```

![[Pasted image 20251213112337.png]]

Создать конфиг:

```roff
microk8s config > ~/.kube/config
```

![[Pasted image 20251213112400.png]]

Проброс порта для подключения к dashboard локально

```roff
microk8s kubectl port-forward -n kube-system service/kubernetes-dashboard 10443:443
```

![[Pasted image 20251213133641.png]]

Проверка локального подключения:

```roff
curl -k https://127.0.0.1:10443
```

![[Pasted image 20251213133713.png]]

Проброс порта для подключения к dashboard из любого места

```roff
microk8s kubectl port-forward -n kube-system service/kubernetes-dashboard 10443:443 --address 0.0.0.0
```

![[Pasted image 20251213133803.png]]
![[Pasted image 20251213133815.png]]

Подключение к dashboard

```roff
microk8s status -a rbac
```


![[Pasted image 20251213133850.png]]

Получение токена для подключения

```roff
microk8s kubectl describe secrets -n kube-system microk8s-dashboard-token 
```

![[Pasted image 20251213134026.png]]

![[Pasted image 20251213134032.png]]

![[Pasted image 20251213134038.png]]

Установка kubectl:

```roff
curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
```

![[Pasted image 20251213134051.png]]

```roff
chmod +x ./kubectl
```

```
sudo mv ./kubectl /usr/local/bin/kubectl
```

```
source <(kubectl completion bash)
```

```
echo "source <(kubectl completion bash)" >> ~/.bashrc
```

Создаем файл конфига для kubectl (можно не создавать т.к. мы его создали до этого просто как пример)

```roff
microk8s config > .kube/config
```

Проверка получаем информацию о подах

```roff
kubectl get pods -A
```

![[Pasted image 20251213134108.png]]

```roff
kubectl version
```

![[Pasted image 20251213134118.png]]

Подключение к кластеру через kubectl c другой машины:

```roff
mkdir .kube
```

```
scp ubuntu@89.169.153.13:/home/ubuntu/.kube/config ~/.kube/
```

![[Pasted image 20251213134133.png]]

```roff
ls .kube/
```

![[Pasted image 20251213134145.png]]

В конфиге изменить айпи адрес на внешний адрес кластера microk8s

```roff
vim .kube/config
```

![[Pasted image 20251213134158.png]]

Проверить подключение к кластеру

```roff
kubectl get pods -A
```

![[Pasted image 20251213134208.png]]

Более подробная информация о нодах

```roff
kubectl get nodes -o wide
```

![[Pasted image 20251213134222.png]]
