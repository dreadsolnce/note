Список открытых портов:
```
sudo netstat -tlpn
```

![[Снимок экрана от 2025-12-07 11-51-46.png]]

Проверить статус microk8s:
```
`microk8s status --wait-ready`
```

![[Снимок экрана от 2025-12-07 11-49-04.png]]

Получить список нод:
```
microk8s kubectl get nodes
```

![[Снимок экрана от 2025-12-07 11-50-13.png]]

Установить addon dashboard
```
microk8s enable dashboard
```

![[Снимок экрана от 2025-12-07 11-53-26.png]]

Список addon:
```
microk8s status
```

![[Снимок экрана от 2025-12-07 11-57-47.png]]

Вывод конфигурации:
```
microk8s config
```

![[Снимок экрана от 2025-12-07 11-59-18.png]]

Настройка внешнего подключения
```
sudo vim /var/snap/microk8s/current/certs/csr.conf.template
```

```
# [ alt_names ]
# Add
# IP.3 = 10.128.0.11
# IP.4 = 89.169.153.13
```

![[Снимок экрана от 2025-12-07 12-03-53.png]]

Обновить сертификаты:
```
sudo microk8s refresh-certs --cert front-proxy-client.crt
```

![[Снимок экрана от 2025-12-07 12-04-54.png]]

Обновить корневой сертификат:
```
sudo microk8s refresh-certs -e ca.crt
```

![[Снимок экрана от 2025-12-07 12-12-10.png]]

Создать конфиг:
```
microk8s config > ~/.kube/config
```

![[Снимок экрана от 2025-12-07 12-13-51.png]]

Проброс порта для подключения к dashboard локально

```
microk8s kubectl port-forward -n kube-system service/kubernetes-dashboard 10443:443
```

![[Снимок экрана от 2025-12-07 12-15-36.png]]

Проверка локального подключения:

```
curl -k https://127.0.0.1:10443
```

![[Снимок экрана от 2025-12-07 12-17-16.png]]

Проброс порта для подключения к dashboard из любого места

```
microk8s kubectl port-forward -n kube-system service/kubernetes-dashboard 10443:443 --address 0.0.0.0
```

![[Снимок экрана от 2025-12-07 12-19-10.png]]

![[Снимок экрана от 2025-12-07 12-20-30.png]]

Поделючение к dashboard
![[Снимок экрана от 2025-12-07 12-22-30.png]]

```
microk8s status -a rbac
```

![[Снимок экрана от 2025-12-07 12-22-14.png]]

Получение токена для подключения
```
microk8s kubectl describe secrets -n kube-system microk8s-dashboard-token 
```

![[Снимок экрана от 2025-12-07 12-25-07.png]]

Подключение к dashboard
![[Снимок экрана от 2025-12-07 12-25-38.png]]

![[Снимок экрана от 2025-12-07 12-26-58.png]]

Установка kubectl:
```
curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
```

![[Снимок экрана от 2025-12-07 12-29-12.png]]

```
chmod +x ./kubectl
```

```
sudo mv ./kubectl /usr/local/bin/kubectl
```

```
source <(kubectl completion bash)
```

```
echo "source <(kubectl completion bash)" >> ~/.bashrc
```

Создаем файл конфига для kubectl (можно не создавать т.к. мы его создали до этого просто как пример)
```
microk8s config > .kube/config
```

Проверка получаем информацию о подах
```
kubectl get pods -A
```

![[Снимок экрана от 2025-12-07 13-17-08.png]]

```
kubectl version
```

![[Снимок экрана от 2025-12-07 13-18-05.png]]

Подключение к кластеру через kubectl c другой машины:
```
mkdir .kube
```

```
scp ubuntu@89.169.153.13:/home/ubuntu/.kube/config ~/.kube/
```

![[Снимок экрана от 2025-12-07 13-22-02.png]]

```
ls .kube/
```

![[Снимок экрана от 2025-12-07 13-22-44.png]]

В конфиге изменить айпи адрес на внешний адрес кластера microk8s

```
vim .kube/config
```

![[Снимок экрана от 2025-12-07 13-29-26.png]]

Проверить подключение к кластеру
```
kubectl get pods -A
```

![[Снимок экрана от 2025-12-07 13-30-10.png]]

Более подробная информация о нодах
```
kubectl get nodes -o wide
```

![[Снимок экрана от 2025-12-07 13-31-31.png]]

