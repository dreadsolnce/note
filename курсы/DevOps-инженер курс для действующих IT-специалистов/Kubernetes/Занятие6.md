### Задание 1
```
kubectl apply -f configmap-multitool.yml
```

```
kubectl get configmaps configmap-multitool
```

```
kubectl describe configmaps configmap-multitool
```

```
kubectl exec -it deployments/web -c multitool-container -- bash
```

### Задание 2

Сгенерировать сертификат для web сервера

```
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt -subj "/CN=myapp.example.com"
```


```
openssl base64 -in tls.crt
```

```
openssl base64 -in tls.key
```
ИЛИ
```
cat tls.crt | base64 -w 0
```

```
cat tls.key | base64 -w 0
```

### Задание 3

Создание самоподписаных сертификатов:

- Создание нового rsa ключа на 2048

```
openssl genrsa -out netology.key 2048
```

![[Снимок экрана от 2025-12-18 18-10-22.png]]

- создаем запрос на выпуск нового сертификата (на вход передаем ключ из предыдущего шага, а на выходе получаем файл с расширением csr). В subj передается имя пользователя (это самое главное). Из под этого пользователя я так понимаю мы будем подключаться к кластеру.
Пример:
```
openssl req -new -key developer.key -out developer.csr -subj "/CN={ИМЯ ПОЛЬЗОВАТЕЛЯ}"
```

```
openssl req -new -key netology.key -out netology.csr -subj "/CN=netology/O=devops"
```
это локальная связка (ключ сертификат)

![[Снимок экрана от 2025-12-18 18-16-21.png]]

- Далее этот сертификат подписывается вышестоящим (т.е. сертификатами кластера microk8s. Т.е. наш сертификат будет как бы в связвке с корневым (microk8s) и когда будем подсоединяться к кластеру кластер узнает внутри нашего сертификата свои данные).

скачиваем с сервера сертификаты (корневые)
```
scp ubuntu@89.169.179.153://var/snap/microk8s/current/certs/ca.crt .
```

```
scp ubuntu@89.169.179.153://var/snap/microk8s/current/certs/ca.key .
```
![[Снимок экрана от 2025-12-18 18-20-57.png]]

![[Снимок экрана от 2025-12-18 18-21-49.png]]

Теперь выпускаем новый сертификат с названием netology.crt именно для нашего пользователя netology с помощью созданных локальных сертификатов и скачанных (как бы объединяем их) что бы сервер microk8s узнавал себя. Можно сказать что мы его подписываем корневыми сертификатами скачанными с сервера
Пример:
```
openssl x509 -req -in developer.csr -CA {CA серт вашего кластера} -CAkey {CA ключ вашего кластера} -CAcreateserial -out developer.crt -days 365
```

```
openssl x509 -req -in netology.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out netology.crt -days 500
```

![[Снимок экрана от 2025-12-18 18-27-41.png]]

![[Снимок экрана от 2025-12-18 18-29-06.png]]

- Создаем нового пользователя netology c привязкой его к сертификату и ключу

```
kubectl config set-credentials netology --client-certificate=netology.crt --client-key=netology.key
```

![[Снимок экрана от 2025-12-18 18-32-39.png]]

- Создаем новый контекст с новым пользователем

 ```
 kubectl config set-context netology --cluster=microk8s-cluster --user=netology
 ```

![[Снимок экрана от 2025-12-18 18-36-06.png]]

```
microk8s enable rbac
```

-  Переключиться на контекст netology

```
kubectl config use-context netology
```

```
kubectl get pods 
```

![[Снимок экрана от 2025-12-18 18-39-58.png]]

