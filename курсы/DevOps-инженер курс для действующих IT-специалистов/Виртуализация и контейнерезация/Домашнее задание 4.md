##### Часть 1

docker pull nginx:1.21.1

Создать файл Dockerfile:

	FROM nginx:1.21.1
	COPY ./index.html /usr/share/nginx/html/index.html

Создать файл index,html:

	<html>
	<\head>
	Hey, Netology
	</head>
	<body>
	<h1>I will be DevOps Engineer!</h1>
	</body>
	</html>

Создать собственный образ:

docker build -t mynginx:1.0.0 .

Запустить контейнер на основе созданного образа:

docker run -d --name mynginx -p 8888:80 mynginx:1.0.0

Проверить работу запущенного контейнера:

docker ps

Протестировать контейнер: 

curl http://127.0.0.1:8888

Остановить и удалить контейнер:

docker stop mynginx

docker rm mynginx

Выполнить авторизацию на docker hub:

```
docker login -u kolchinvladimir
```

Нужно перестроить образ под нашим именем пользователя docker hub и убедиться, что у него есть тег:

```
docker build -t kolchinvladimir/custom-nginx:1.0.0 .
```

Запушить образ на docker hub:

```
docker image push kolchinvladimir/custom-nginx:1.0.0
```
##### Часть 2

Запускаем контейнер:

```
docker run --name KVL-custom-nginx-t2 -d -p 127.0.0.1:8080:80 kolchinvladimir/custom-nginx:1.0.0
```

Переименовываем контейнер:

```
docker rename KVL-custom-nginx-t2 custom-nginx-t2
```

Выполнить команду:

```
date +"%d-%m-%Y %T.%N %Z" ; sleep 0.150 ; docker ps ; ss -tlpn | grep 127.0.0.1:8080 ; docker logs custom-nginx-t2 -n1 ; docker exec -it custom-nginx-t2 base64 /usr/share/nginx/html/index.html
```

Проверить вывод:

```
curl http://127.0.0.1:8080
```

##### Часть 3

```
docker attach KVL-custom-nginx-t2
```

```
docker run -d -it --rm --name nginx -p 127.0.0.1:8080:80 image-nginx:1.0.0
```

```
docker exec -it nginx bash
```

```
vim /etc/nginx/conf.d/default.conf
```
> Изменить порт 80 на порт 81

```
nginx -s reload
```

```
curl http://127.0.0.1:80 ; curl http://127.0.0.1:81
```

```
exit
```

```
ss -tlpn | grep 127.0.0.1:8080 && docker port nginx && curl http://127.0.0.1:8080
```

```
docker stop nginx
```

Запустим снова контейнер, только без ключа --rm

```
docker run -d -it --name nginx -p 127.0.0.1:8080:80 image-nginx:1.0.0
```

```
sudo systemctl stop docker.service
```

```
sudo ls /var/lib/docker/containers/
```

Скопировать ID

```
sudo ls /var/lib/docker/containers/ff2c97d40eb7b3bb27357dbabe90a8a34656559885d10368a835422b293afbb6
```

```
sudo vim /var/lib/docker/containers/ff2c97d40eb7b3bb27357dbabe90a8a34656559885d10368a835422b293afbb6/hostconfig.json
```

> Изменить значение параметра PortBindings
> 
> "PortBindings":{"81/tcp":[{"HostIp":"127.0.0.1","HostPort":"8080"}]}

```
sudo vim /var/lib/docker/containers/ff2c97d40eb7b3bb27357dbabe90a8a34656559885d10368a835422b293afbb6/config.v2.json
```


> Изменить значение параметра ExposedPorts
> 
> "ExposedPorts":{"81/tcp":{}}

```
sudo systemctl start docker.service
```

```
docker start nginx
```

```
docker ps
```

```
curl http://127.0.0.1:8080
```


```
docker rm -f nginx
```
##### Часть 4

```
docker run -d -it -v $(pwd):/data --name centos centos:7 bash
```

```
docker run -d -it -v $(pwd):/data --name debian debian:stable bash
```

```
docker exec -it centos bash
```

```
touch /data/testFile.txt
```

```
exit
```

```
touch testFile_2.txt
```

```
docker exec -it debian bash
```

```
ls /data
```

```
exit
```

##### Часть 5

```
mkdir task5
```

```
cd task5
```

```
vim compose.yaml
```

>version: "3"
 services:
   portainer:
     network_mode: host
     image: portainer/portainer-ce:latest
     volumes:
       - /var/run/docker.sock:/var/run/docker.sock

***Графическая оболочка для управления образами docker из графики (работает на 9000 порту)***

```
vim docker-compose.yaml
```

>version: "3"
 services:
   registry:
     image: registry:2
     ports:
       - "5000:5000"

***Образ registry:2 - образ локального registry (локальный репозиторий образов на подобии docker hub  registry)***

```
docker compose up -d
```

```
docker compose down
```

```
vim compose.yaml
```

> include:
>   - docker-compose.yaml
> service:
>   ...

```
docker compose up -d
```


***Загрузка образа в локальный репозиторий (локальный regisstry):***
[ссылка на статью с distribution.github.io](https://distribution.github.io/distribution/about/deploying/)

Скачиваем образ из удаленного репозитория:

```
docker pull kolchinvladimir/custom-nginx:2.0.0
```

Добавляем тег localhost:5000/custom-nginx:2.0.0 к образу (kolchinvladimir/custom-nginx:2.0.0).
Если первая часть тега — это имя хоста и порт, Docker интерпретирует это как расположение реестра при выполнении push

```
docker tag kolchinvladimir/custom-nginx:2.0.0 localhost:5000/custom-nginx:latest
```

Загружаем (пушим) образ в локальный репозиторий

```
docker push localhost:5000/custom-nginx:latest
```

Открываем браузер (http://http://158.160.40.72:9000)

Home -> local -> Stacks -> Add stack -> Web editor

>version: '3'
 services:
   nginx:
     image: 127.0.0.1:5000/custom-nginx
     ports:
       - "9090:80"

Задать имя task5_1

