#### Задача №1

Установка virtualbox:
```
 #!/bin/bash
sudo apt update
sudo apt install virtualbox
sudo apt install virtualbox-ext-pack
sudo usermod -a -G vboxusers $USER
sudo systemctl reboot
```

 Установка vargant:
```
#!/bin/bash
wget https://hashicorp-releases.yandexcloud.net/vagrant/2.4.8/vagrant_2.4.8-1_amd64.deb
sudo dpkg -i vagrant_2.4.8-1_amd64.deb
rm vagrant_2.4.8-1_amd64.deb*
vagrant -v
```

Установка packer:
```
#!/bin/bash
wget https://hashicorp-releases.yandexcloud.net/packer/1.14.1/packer_1.14.1_linux_amd64.zip -P ~/packer
unzip ~/packer/packer_1.14.1_linux_amd64.zip -d ~/packer
sudo cp ~/packer/packer /usr/local/bin/packer
rm -r ~/packer
packer --version
touch ~/.config/config.pkr.hcl
echo "packer {" > ~/.config/config.pkr.hcl
echo "  required_plugins {" >> ~/.config/config.pkr.hcl
echo "    yandex = {" >> ~/.config/config.pkr.hcl
echo '     version = ">= 1.1.2"' >> ~/.config/config.pkr.hcl
echo '     source  = "github.com/hashicorp/yandex"' >> ~/.config/config.pkr.hcl
echo "    }" >> ~/.config/config.pkr.hcl
echo "  }" >> ~/.config/config.pkr.hcl
echo "}" >> ~/.config/config.pkr.hcl
packer init ~/.config/config.pkr.hcl
```

Установка yandex cloud cli:
```
##!/bin/bash
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
exec -l $SHELL
#firefox https://oauth.yandex.ru/authorize?response_type=token&client_id=1a6990aa636648e9b2ef855fa7bec2fb&_ym_uid=1754464682659359787&mc=v &
yc init
yc config list
```

#### Задача №2

***Создаем виртуальную машину:***

```
mkdir -p ~/vagrant/netology/src

cd ~/vagrant/netology/src

vim Vagrantfile

# Подключить vpn
vagrant up

# Проверка успешности выполнения задания

docker version && docker compose version

```

***Дополнительные команды vagrant:***

```
=> Выйти из виртуальной машины в консоль:
exit

=> Посмотреть статус виртуальных машин:
vagrant status

=> Выключить виртуальную машину:
vagrant halt

=> Удалить виртуальную машину:
vagrant destroy


```

#Vagrantfile:
```
##Обратите внимание!! Скрипт установки docker рассчитан на ubuntu-20.04
ISO = "bento/ubuntu-20.04"
NET = "192.168.56."
DOMAIN = ".netology"
HOST_PREFIX = "server"

servers = [
  {
    :hostname => HOST_PREFIX + "1" + DOMAIN,
    :ip => NET + "11",
    :ssh_host => "20011",
    :ssh_vm => "22",
    :ram => 1024,
    :core => 1
  }
]

Vagrant.configure(2) do |config|
  config.vm.synced_folder ".", "/vagrant", disabled: false
  servers.each do |machine|
    config.vm.define machine[:hostname] do |node|
      node.vm.box = ISO
      node.vm.hostname = machine[:hostname]
      node.vm.network "private_network", ip: machine[:ip]
      node.vm.network :forwarded_port, guest: machine[:ssh_vm], host: machine[:ssh_host]
      node.vm.provider "virtualbox" do |vb|
        vb.customize ["modifyvm", :id, "--memory", machine[:ram]]
        vb.customize ["modifyvm", :id, "--cpus", machine[:core]]
        vb.name = machine[:hostname]
      end
      node.vm.provision "shell",  inline: <<-EOF
        export DEBIAN_FRONTEND=noninteractive
        # Add Docker's official GPG key:
        sudo apt-get update
        sudo apt-get install ca-certificates curl gnupg
        sudo install -m 0755 -d /etc/apt/keyrings
        curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
        sudo chmod a+r /etc/apt/keyrings/docker.gpg

        # Add the repository to Apt sources:
        echo \
          "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
          $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
          sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
        
        sudo apt-get update
        sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
      EOF
    end
  end
end
```

#### Задача №3

**Дополнительные команды yc (yandex cloud):**

```
=> Посмореть список образов в облаке:
yc compute image list

=> Посмореть список vm в облаке:
yc compute instance list

=> Остановить vm
yc compute instance stop <name>

=> Запустить vm
yc compute instance start <name>

=> Перезапустить vm
yc compute instance restart <name>

=> Удалить vm
yc compute instance delete <name>

=> Посмотреть список сетей
yc vpc network list

=> Изменить имя сети:
yc vpc network update net --new-name my-net

=> Посмотреть список под сетей
yc vpc subnet list

=> Список дисков
yc compute disk list

=> Удалить диск
yc compute disk delete disk-1754483572278

=> Список подготовленных образов\
yc compute image list

=> Удалить образ
yc compute image delete  debian-11-docker
```

***Создание сети и под сети внутри сети:***

1. Создание сети
```
yc vpc network create --name net --labels my-label=netology --description "My network"
```

2. Создание под сети:
```
yc vpc subnet create --name my-subnet-a --zone ru-central1-a --range 10.1.2.0/24 --network-name net --description "My subnet"
```

***Отредактируем файл конфигурации packer добавив установку в него программы docker***

Пример файла mydebian.json

```
{
    "builders": [
        {
            "type": "yandex",
            "token": "y0_AgAAAAA...это точно секретные данные!",
            "folder_id": "b1gfu..не секретные данные",
            "zone": "ru-central1-a",
            "image_name": "debian-11-docker",
            "image_description": "my custom debian with docker",
            "source_image_family": "debian-11",
            "subnet_id": "e9bhm45v9j5tna68jf9n...совсем не секретные данные",
            "use_ipv4_nat": true,
            "disk_type": "network-hdd",
            "ssh_username": "debian"
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "inline": [
                "echo 'hello from packer'"
            ]
        }
    ]
}
```


Изменённый файл под мою конфигурацию:

```
{
    "builders": [
        {
            "type": "yandex",
            "token": "y0__xxx",
            "folder_id": "b1gdmpusv51ippn2psip",
            "zone": "ru-central1-a",
            "image_name": "debian-11-docker",
            "image_description": "my custom debian with docker",
            "source_image_family": "debian-11",
            "subnet_id": "e9brbkps9ho16v8ka5t2",
            "use_ipv4_nat": true,
            "disk_type": "network-hdd",
            "ssh_username": "debian"
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "inline": [
                "echo 'hello from packer'",
                "sudo sed -i '/bullseye-backports/s/^/#/' /etc/apt/sources.list",
                "sudo apt-get update",
                "sudo apt-get install htop tmux -y",
                "curl -fsSL https://get.docker.com -o get-docker.sh",
                "sudo sh get-docker.sh"
            ]
        }
    ]
}


```

***Запускаем наш конфигурационный файл для создания образа в yandex cloude:***

```
=> Проверка файла конфигурации:
packer validate mydebian.json

=> Создание образа:
packer build mydebian.json

=> Проверить снова список образов:
yc compute image list
```