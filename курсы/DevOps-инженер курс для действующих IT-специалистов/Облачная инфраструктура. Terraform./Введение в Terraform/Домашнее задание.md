[Ссылка на домашнее задание](https://github.com/netology-code/ter-homeworks/blob/main/01/hw-01.md)

```
sudo ./install_terraform.sh
```

```
terraform --version
```

```
git clone https://github.com/netology-code/ter-homeworks.git
```

```
docker --version
```

#### Задание 1

```
cd ter-homeworks/01/src/
```

```
cat .gitignore
```

Допустимо хранить секретную информацию в файле: personal.auto.tfvars

```
wg-quick up client_02
```

```
terraform init
```

```
terraform apply
```

Результат: "result": "jnOOKq5DKq12WKlk"

```
vim main.tf
```

--> Раскоментировать

первая ошибка: блок resource должен содержать обязательно два параметра, а именно тип объекта и уникальное имя в текущем проекте. Отсутствует имя.
вторая ошибка: уникальное имя должно начинаться с буквы и содержать буквы,символы подчёркивания, цифры, и символ тире. Начинается с цифры.
третья ошибка: переменная random_string_FAKE не объявлена. Вместо нее надо использовать random_string. А также также аргумент result 

```
terraform apply
```

```
resource "docker_image" "nginx" {
  name         = "nginx:latest"
  keep_locally = true
}

resource "docker_container" "nginx" {
  image = docker_image.nginx.image_id
  name  = "example_${random_password.random_string.result}"

  ports {
    internal = 80
    external = 9090
  }
}
```

![[Снимок экрана от 2025-08-19 14-33-02.png]]

Опасность применения ключа заключается в том что изменения применяются без дополнительного одобрения (т.е. без ввода YES). Отсутствует дополнительный контроль при внесении изменений.
Использование данного ключа -auto-approve может полезно в пайплайнах CI/CD при автоматизации процесса сборки, тестирования и развёртывания.
![[Снимок экрана от 2025-08-19 15-27-07.png]]

![[Снимок экрана от 2025-08-19 15-42-54 1.png]] <br>
![[Снимок экрана от 2025-08-19 15-43-05 1.png]]

![[Снимок экрана от 2025-08-19 15-44-05 1.png]]

Ответ: keep_locally = true БЮ
Атрибут keep_locally в ресурсе Terraform docker_image определяет, будет ли образ Docker, управляемый этим ресурсом, удален с локального хоста Docker при уничтожении ресурса Terraform.
Соответственно значение true атрибута keep_locally говорит нам, что образ nginx:latest останется на локальном хосте при уничтожении ресурсов с помощью terraform. Это может быть полезно
если от данного образа зависят другие процессы. 

Строка из документации:
[`keep_locally`](https://docs.comcloud.xyz/providers/kreuzwerker/docker/latest/docs/resources/image#keep_locally-1) (Boolean) If true, then the Docker image won't be deleted on destroy operation. If this is false, it will delete the image from the docker local storage on destroy operation.

#### Задание 2

main.tf
```
terraform {  
  required_providers {  
    docker = {  
      source  = "kreuzwerker/docker"  
      version = "~> 3.0.1"  
    }  
  
    random = {  
      source  = "hashicorp/random"  
      version = "3.6.3"  
    }  
  }  
  required_version = ">=1.8.4" /*Многострочный комментарий.  
 Требуемая версия terraform */}  
  
provider "docker" {  
  host = "ssh://ubuntu@51.250.92.112:22"  
  ssh_opts = ["-o", "StrictHostKeyChecking=no", "-o", "UserKnownHostsFile=/dev/null"]  
}  
  
resource "random_password" "root_password" {  
  length = 8  
}  
  
resource "random_password" "password" {  
  length = 8  
}  
  
resource "docker_image" "mysql" {  
  name = "mysql:8"  
}  
  
resource "docker_container" "mysql" {  
  image = docker_image.mysql.name  
  name  = "mytestmysql"  
  
  env = [  
    "MYSQL_ROOT_PASSWORD=${random_password.root_password.result}",  
    "MYSQL_DATABASE=wordpress",  
    "MYSQL_USER=wordpress",  
    "MYSQL_PASSWORD=${random_password.password.result}",  
    "MYSQL_ROOT_HOST=localhost"  
  ]  
  
  ports {  
    internal = 3306  
    external = 3306  
    ip = "127.0.0.1"  
  }  
}
```

.terraformrc
```
provider_installation {  
  network_mirror {  
    url = "https://terraform-mirror.yandexcloud.net/"  
    include = ["registry.terraform.io/*/*"]  
  }  
  direct {  
    exclude = ["registry.terraform.io/*/*"]  
  }  
}
```

.gitignore
```
# Local .terraform directories and files  
**/.terraform/*  
.terraform*  
  
!.terraformrc  
  
# .tfstate files  
*.tfstate  
*.tfstate.*
```

[Ссылка на github](https://github.com/dreadsolnce/zad2)

#### Задание 3

```
curl --proto '=https' --tlsv1.2 -fsSL https://get.opentofu.org/install-opentofu.sh -o install-opentofu.sh
```

```
chmod +x install-opentofu.sh
```

```
./install-opentofu.sh --install-method deb
```

![[Снимок экрана от 2025-08-19 18-24-09.png]]

![[Снимок экрана от 2025-08-19 18-24-21 1.png]]

![[Снимок экрана от 2025-08-19 18-24-45.png]]