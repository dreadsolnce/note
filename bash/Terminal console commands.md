
| Команда                                                      | Описание                                                                   | Ключи                                                       |
| :----------------------------------------------------------- | :------------------------------------------------------------------------- | ----------------------------------------------------------- |
| hostname -I                                                  | *Вывод ай пи адреса хоста:*                                                |                                                             |
| ip a                                                         |                                                                            |                                                             |
| sudo useradd -m -s /usr/sbin/nologin test                    | Создать пользователя с дом.каталогом без входа в shell                     | -m : домашний каталог                                       |
| sudo useradd -m -s /bin/bash test                            | Создать пользователя с дом.каталогом и оболочкой bash                      | -s : оболочка                                               |
| usermod -a -G <группа> <пользователь>                        | Добавить пользователя в дополнительную группу                              |                                                             |
| sudo passwd test                                             | Задать пароль пользователю test                                            |                                                             |
| sudo tcpdump -i enp0s8 port 80 and tcp and src 192.168.192.1 | *Проверка (сканирование) портов с помощью tcpdump:*                        |                                                             |
| sudo du -sh -t 13M /var/* \| sort -n -k 5 -r                 | *Сортировка по 5 столбцу в обратном порядке:*                              | -n : сортировка строк linux по числовому значению           |
|                                                              |                                                                            | -k : указать поле по которому нужно сортировать строки      |
|                                                              |                                                                            | -r : сортировка в обратном порядке                          |
| grep -i -R "string to find" /etc/apt/*                       | *Поиск по содержимому файлов:*                                             | -q : тихий режим                                            |
| ufw status verbose \| egrep -q -x "(активен\|active)"        | *Поиск по нескольким параметрам:*                                          | -i  : поиск не зависит от регистра                          |
|                                                              |                                                                            | -R : рекурсивный поиск со всеми подкаталогами               |
|                                                              |                                                                            | -x : точное совпадение с целой строкой                      |
|                                                              |                                                                            | -w : точное совпадение с целым словом                       |
|                                                              |                                                                            | -P : использование регулярных выражений                     |
|                                                              |                                                                            | -v : поиск наоборот (не выводить то что подошло по условию) |
|                                                              |                                                                            | -F : переданный шаблон воспринимается буквально             |
| find / -name ansible 2> /dev/null                            | *Поиск по имени файла:*                                                    |                                                             |
| command -v ufw                                               | *Поиск расположения команды по названию :*                                 |                                                             |
| type <имя команды>                                           |                                                                            |                                                             |
| whereis <имя команды>                                        |                                                                            |                                                             |
| which <имя команды>                                          |                                                                            |                                                             |
| whatis <команда>                                             | *Информация по команде*                                                    |                                                             |
| dpkg -S <команда>                                            | *Какому пакету принадлежит команда*                                        |                                                             |
| mkisofs -o file.iso \<path to add iso\>                      | *Создание iso файла*                                                       |                                                             |
| kill -s QUIT 4716                                            | *Мягкое завершение процесса*                                               |                                                             |
| kill -s SIGKILL 4716                                         | *Жёсткое закрытие процесса*                                                |                                                             |
| killall -HUP prometheus                                      | *Перечитать конфигурацию программы (prometheus).Аналогичен сигналу SIGHUP* |                                                             |
| printenv                                                     | *Вывести все переменные окружения*                                         |                                                             |
| ps -efl                                                      | *Просмотр запущенных процеcсов*                                            |                                                             |
| ps afx                                                       | *Просмотр запущенных процесcов*                                            |                                                             |
| chattr +i /boot/grub/grub.cfg                                | Заблокировать файл от изменений                                            | +i : заблокировать                                          |
|                                                              |                                                                            | -i : отменить блокировку                                    |
| touch -mad "2025-06-17 10:42:00" cat.jpg                     | Установка времени изменения файла                                          | -d : принимает строковое значение                           |
|                                                              |                                                                            | -m : дата модификации                                       |
|                                                              |                                                                            | -a : дата открытия файла                                    |
|                                                              |                                                                            |                                                             |
Железо:
*Общее количество доступных процессоров в системе:*
```
nproc
```

##### ***==Сеть==***
*Вывод ай пи адреса хоста:*
```
hostname -I    
```

```
ip a
```

*Проверка (сканирование) портов с помощью tcpdump:*
```
sudo tcpdump -i enp0s8 port 80 and tcp and src 192.168.192.1
```

Просмотр существующих маршрутов в windows:
```
route print
```

Утилита **traceroute** - определение где обрывается соединение

> [!NOTE] ключи
> - **-4** или **-6** - использовать ipv4 или ipv6 протокол;
> - **-I** - использовать ICMP пакеты вместо UDP;
> - **-T** - использовать TCP пакеты вместо UDP;
> - **-F** - не фрагментировать пакеты;
> - **-f** - указать TTL с которого нужно начать;
> - **-g** - передавать пакет через указанный шлюз;
> - **-i** - передавать пакет через указанный интерфейс;
> - **-m** - максимальное количество узлов, через которые пройдет пакет;
> - **-q** - количество пакетов, отправляемых за раз, по умолчанию три;
> - **-n** - не узнавать доменные имена;
> - **-p** - указать порт вместо порта по умолчанию;
> - **-w** - установить время ожидания ответа от узла, по умолчанию полсекунды;
> - **-r** - использовать другой роутер вместо того, что указанный в таблице маршрутизации;
> - **-z** - минимальный интервал между пакетами;
> - **-U** - использовать UDP с увеличением номера порта;
> - **-UL** - использовать протокол UDPLITE;
> - **-D** - использовать протокол DCCP;
> - **--mtu** - указать размер пакета;
> - **-P** - протокол, доступны такие значения: raw, dccp, udplite, udp, tcpconn, tcp, icmp.

***Вместо одного узла вы можете видеть звездочки traceroute - Это означает что всего лишь он не захотел нам отвечать.***

По умолчанию traceroute работает по udp

```
traceroute 8.8.8.8
```

ICMP протокол:
```
traceroute -I 8.8.8.8
```
```
traceroute --icmp 8.8.8.8
```

TCP протокол по порту 443
```
traceroute -T -p 443 8.8.8.8
```
```
traceroute --tcp -p 443 8.8.8.8
```

Сканирование открытых портов на удалённом сервере **ОЧЕНЬ ОПАСНО - ОТСЛЕЖИВАЮТ**:

```
# Обычное сканирование. использует концепцию полного трехстороннего квитирования.
# 
nmap localhost

# Скрытое cканирование TCP
nmap -sS localhost 

# Скрытое cканирование UDP
nmap -sU localhost 

# Сканирование по конкрутному порту
nmap localhost -p 8443
```

- **Открытый**: статус открыто означает, что данный порт открыт и на нем активно запущена служба.
    
- **Отфильтрованный (Filtered)**: означает, что брандмауэр, фильтр, или что-то другое в сети блокирует порт. 
    
- **Закрытый**: закрытое состояние означает, что данный порт закрыт на хост-компьютере.  
	
- **Unfiltered**: порты отвечают на запросы Nmap, но нельзя определить, являются ли они открытыми или закрытыми.

Отправка запросов через curl:
```
# Справка по комманде
curl --help category
curl help https
```

```
# выполняет HTTP-запрос get и отображает статическое содержимое страницы
curl https://google.com
curl https://google.com:8443
```

```
# Скачать файл и сохранить под оригинальным названием
curl -O https://testdomain.com/testfile.tar.gz
```

```
# Скачать файл
curl https://testdomain.com/testfile.tar.gz > name_file.gz
```

```
# Скачать файл с добавочным заголвком (т.е. сервер вернёт файл в архивированном виде)
curl -H 'Accept-Encoding: gzip,deflare' https://testdomain.com/testfile.tar.gz > name_file.gz
```

![[Снимок экрана от 2025-06-17 15-03-55.png]]

```
# Посмотреть, какие заголовки отдает сервер
curl -I https:/google.com
```

```
# Запрос с добавлением имени сайта
curl -H "Host: example.com" https://your-domain.com/path
```

```
# Посмотреть, какие заголовки отдает сервер, при запросе с добавленным в ручну заголовком
curl -I -H 'Accept-Encoding: gzip,deflare' https:/google.com
```

![[Снимок экрана от 2025-06-17 14-38-46.png]]

```
# Отправка запроса с query параметрами и выводов всех заголовков
curl http://127.0.0.1:8080/response-headers\?test\=test\&server\=httpbin -H "Host: new.httpbin.local" -v
```
![[Снимок экрана от 2025-06-25 16-24-13.png]]

```
# Подключится к прокси серверу
curl -x "http://kvl:wo4aLm3rZ@212.23.211.120:3128" "https://mail.ru"
```

```
# Игнорирование ошибки неправильных или самоподписанных сертификатов
curl -k https:/google.com
```

```
# Использование авторизации
curl -u <user:password> https://my-test-api.com/endpoint1
```

```
# Узнать какой процесс использует порт
lsof -i :80
```

```
# созданы активные сетевые соединения
netstat -ap
```

```
# Более краткий список
netstat -A inet –program
```

```
# Еще вариант
netstat -tvaep
```
##### ==Пользователи==

Создание пользователя:
```
useradd -m -s /bin/bash kvl
```

```
usermod -aG kvl kvl
```

```
passwd kvl
```

Создание системного пользователя:
```
useradd -s /usr/sbin/nologin -U -M -r proxyuser
```
-r, --system                  create a system account
-U, --user-group              create a group with the same name as the user
-M, --no-create-home          do not create the user's home directory

***Работа с разрешениями на папки для пользователей (например для nginx):***
Задаем владельца каталогов и находящихся внутри файлов:
```
chown -R webuser:webuser /home/webuser/www/
```

```
chown -R webuser:webuser /home/webuser/tmp/
```

Добавляем пользователя www-data в группу webuser:
```
usermod -aG webuser www-data
```

##### ==Терминал==

<h4>Не добивает команды с помощью клавиши TAB</h4>
Установить пакет:

```
sudo apt insall bash-completion
```

Скопировать в буфер обмена

```
sudo apt install xclip
`alias pbcopy='xclip -selection clipboard'`
`alias pbpaste='xclip -selection clipboard -o'`
или
`alias pbcopy='xsel --clipboard --input'`
`alias pbpaste='xsel --clipboard --output'`

ls -al | pbcopy
```
##### ==Размер==
Размер каталогов в отсортированом виде:
```
sudo du -sh -t 13M /var/* | sort -n
```

Сортировка по 5 столбцу:
```
sudo du -sh -t 13M /var/* | sort -n -k 5 -r
```
> -n : сортировка строк linux по числовому значению
> -k : указать поле по которому нужно сортировать строки
> -r : сортировка в обратном порядке
##### ***==Поиск==***

*Поиск по содержимому файлов:*
```
grep -i -R "string to find" /etc/apt/*
```
*Поиск по нескольким параметрам:*
```
ufw status verbose | egrep -q -x "(активен|active)"
```

> [!NOTE] ключи
> -q : тихий режим
> -i  : поиск не зависит от регистра
> -R : рекурсивный поиск со всеми подкаталогами
> -x : точное совпадение с целой строкой 
> -w : точное совпадение с целым словом
> -P : использование регулярных выражений
> -v : поиск наоборот (не выводить то что подошло по условию)
> -F : переданный шаблон воспринимается буквально

*Поиск по имени файла:*
```
find / -name ansible 2> /dev/null
```

*Поиск файла по дате (найти в каталоге файлы, которые были модифицированы после 03.14.2025):*
```
find . -maxdepth 1 -newermt "03/14/2025"
```

*Найти файлы, которые были модифицированы за последние десять дней*
```
find . -mtime -10
```

Вывод файлов с датой в формате мм.дд.гг и сортировкой по дате
```
ls -alt --time-style=+%D
```

*Поиск расположения команды по названию :*
```
command -v ufw
```
```
type <имя команды>
```
```
whereis <имя команды>
```
```
which <имя команды>
```

*Информация по команде:*
```
whatis <имя команды>
```

*Поиск пакета которому принадлежит команда:*
```
whereis column
apt-file search column | grep /usr/bin/column
```
##### ***==Системные команды==***
*Изменение имени хоста:*
```
sudo hostnamectl hostname <новое имя>
```

*Выключение компьютера из под пользователя:*
```
systemctl poweroff
```

*Запуск sudo без пароля:*
```
sudo visudo
```

> [!NOTE] add string
> <test_user> ALL=(ALL) NOPASSWD: ALL

Также можно создавать файлы в директории /etc/sudoers.d

```
visudo -f /etc/sudoers.d/nopass
```

![[Снимок экрана от 2025-05-30 11-44-57.png]]

```
sudo chmod 440 nopass
```

*Запуск определённой команды через sudo без пароля:*
```
sudo visudo
```
> [!NOTE] add string
> <test_user> ALL=NOPASSWD:/usr/local/bin/imagel

*Запуск команды от другого пользователя:*
```
sudo -u <test_user> <name prog>
```

*Переключение на другого пользователя:*
```
sudo -u postgres -i
```

> sudo su только изменяет текущего пользователя на root. Настройки среды остаются прежними.
> sudo -i создает новую среду, как если бы root только что вошел в систему.
> su - действия выполняются от суперюзера

*Просмотр запущенных процессов:*
```
ps -efl
ps afx
```
##### ==***Логи, оборудование ...***==

*Информация об оперативной памяти*
```
free -h
```

*Мониторинг процессов активно работающих с диском:*
```
sudo iotop
```

*Отслеживание сетевой активности*
```
iftop -i <имя_сетевого_интерфейса>
```

Путь до удалённого сервера:
```
traceroute <сайт>
```

Захват (анализ) сетевого трафика:
```
sudo tcpdump -i eth0
```

Вывод последних 50 логов:
```
journalctl -n 50
journalctl --since "2025-03-03"
journalctl -k
journalctl -u pm2-root
```
> -k : сообщения ядра
> -n : количество 
> -u : имя службы

Просмотр ошибок:

```
sudo journalctl -xeu redis.service
```

Уменьшить максимальный размер журнала:

```
sudo journalctl --vacuum-size=100M
```

```
dmesg --level err, warn
```

```
tail -f /var/log/syslog
```
> /var/log/syslog : системные события
> /var/log/auth.log : логи авторизации
> /var/log/nginx/access.log : доступ с веб серверу Nginx

Регулярная проверка последних 20 строк лога на наличие ошибок 500 от Nginx
```
watch -n 5 "tail -n 20 /var/log/nginx/error.log | grep '500'"
```

Выполнение команды каждую секунду
```
watch -n 1 "date"
```

Информация об оборудовании:
```
cat /proc.cpuinfo
cat /proc/meminfo
cat /proc/loadavg
```
##### ***==Службы==***
Время загрузки ОС (каждой службы)
```
systemd-analyze blame
```

*Статус службы (активна/неактивна):*
```
systemctl is-active nftables.service 
```

Служба в которой в конце стоит знак @
```
systemctl status redis@.service
```
означает, что она должна запускаться с параметром который будет подставлять вместо %i в тексте самой службы:
```
systemctl status redis@redis-server.service
```


*Состояние всех сервисов:*
```
systemctl list-units --type=service
```

Состояние только активных служб:
```
systemctl list-units --type=service --state=active
```

*Перезапуск служб:*
```
systemctl restart app
systemctl reload app
```
> Пояснение: `restart` полностью останавливает приложение и запускает его заново, то `reload` просто позволяет приложению перечитать конфигурационный файл, с которым оно работает, без полного перезапуска

*Пользователь под кем запущена служба:*

```
sudo systemctl status fwupd.service | grep 'Main PID'
```

```
sudo systemctl status commvault.service
ps -u -p 1734375
ps -u -p 1734376
ps -u -p 1734377
```

```
sudo systemctl show commvault.service
```

[Ссылка на статью:](https://jino.ru/spravka/articles/systemctl.html#systemctl)
##### **==Файлы==**
***Количество  строк в файле:***
```
wc -l 
```

***Количество файлов в директории:***
```
find Документы/ -type f -exec ls {} \; | wc -l
```

**Вывод файлов начинающихся с file и заканчивающиеся на .txt**
```
for file in file*.txt; do echo "$file"; done
```

***Вывод файлов заканчивающиеся на .log***
```
for f in *.log; do echo $f;done
```

***Размер файлов через команду ls***
```
ls -lh data/
```

***Сравнение двух файлов:***
```
diff style.xml /home/osm/openstreetmap-carto/style.xml
```

***Создание копии файла с дополнительной датой в названии:***
```
cp style.mss style.mss.bak_$(date +%F)
```
> Результат: style.mss.bak_2025-02-28

***Информация (подробная)о каталоге (файле):***
```
sudo -u www-data stat skillbox/
```

***Создание файлов по шаблону:***
```
touch $(seq -f 'pgsql_2025-05-0%g.sql.gz' 1 9); touch $(seq -f 'pgsql_2025-05-%g.sql.gz' 10 31)
```
> Будут созданы файлы:
> 	pgsql_2025-05-01.sql.gz
> 	pgsql_2025-05-02.sql.gz
> 	...
> 	pgsql_2025-05-10.sql.gz
> 	pgsql_2025-05-11.sql.gz
> 	...
> 	pgsql_2025-05-31.sql.gz

***Поиск (вывод) файлов кроме ..-15.sql.gz***
```
find . \( -name "*-1[^5].*" -o -name "*-[023]?.*" \) | sort
```
> \*-1\[^5].* - Вывод содержащий 1 и любой символ кроме 5 (кроме pgsql_2025-05-15.sql.gz)
> 	pgsql_2025-05-10.sql.gz
> 	pgsql_2025-05-11.sql.gz
> 	...
> 	pgsql_2025-05-19.sql.gz
> \*-\[023]?.* - Вывод всех либо 0 и любой символ, 2 и любой символ, 3 и любой символ
> 	pgsql_2025-05-01.sql.gz
> 	...
> 	pgsql_2025-05-21.sql.gz
> 	...
> 	pgsql_2025-05-31.sql.gz

***Поиск только внутри каталога без подпапок***
```
find /home/kvl/ -maxdepth 1 -type f -name "*.txt"
```

***Вывести файлы содержащие ключевое слово поиска test***
```
grep -l "test" `find /home/kvl/ -maxdepth 1 -type f -name "*.txt"`
```

***Удалить все файлы время изменения метаданных которых больше 61 дня (но не удалять файлы созданные 15 числа)***
```
find $pathB \( -name "*-1[^5].*" -o -name "*-[023]?.*" \) -ctime +61 -delete
```

***Если нужно найти все файлы время изменения содержимого которых старше 3 дней и после чего удалить их:***
```
find /home/captain -type f -mtime +3 -exec rm -rf {} \;
```

***Найти все файлы которые не новее 21 мая 2025:***
```
find . -type f -not -newermt 'may 21 2025'
```

***Найти все файлы которые не старше 19 мая 2025 21:13***
```
find /storage-nfs/ -type f -not -newermt 'may 19 2025 21:13'
```

***Копирование файлов с помощью rsync***
```
sshpass -p $SSH_PSWD rsync --recursive --links  --times --verbose --compress --rsh="sshpass -e ssh -o StrictHostKeyChecking=no" --exclude '.git' --exclude '.gitlab-ci.yml'  --exclude '.gitignore' --exclude '.log' --exclude '.gitlab-ci-varibales.yml' --exclude '.idea' --progress . $SSH_USER@$SSH_SERVER:/var/www/dev.kvlpro.ru
```

> **--recursive, -r** : операция будет применена рекурсивно ко всем вложенным каталогам и файлам внутри указанной директории.
> **--links, -l**     : необходимо обрабатывать символические ссылки (symlinks) как ссылки, а не как обычные файлы. Другими словами, если на исходном сервере есть символическая ссылка, то при синхронизации на целевой сервер будет создана такая же символическая ссылка, а не скопирован файл, на который ссылка указывает.
> **--times, -t**     : сохранение времени изменения файлов при синхронизации.
> **--verbose, -v**   : увеличивает объем выводимой информации во время передачи данных.
> **--compress, -z**  : включает сжатие данных при передаче файлов по сети.

***Добавить строку в конец файла***

```
echo "строка" | tee -a file*.conf
```
##### **==Установщик пакетов==**
*Поиск пакета в хранилище репозитариев:*
```
apt-cache search <имя пакета>
```

*Информация установлен пакет или нет:*
```
apt-cache policy <имя пакета>
```

*Установить вместе с предлагаемыми пакетами:*
```
sudo apt install nginx --install-suggests
```

Установить/переустановить:
```
sudo apt-get install --reinstall packet
```

Установить/переустановить пакет определённой версии:
```
sudo apt install --reinstall zabbix-agent2=1:6.0.2-1+ubuntu20.04
```

Добавить только архитектуру amd64:

```
sudo vim /etc/apt/sources.list.d/zabbix.conf
deb [arch=amd64] https://repo.zabbix.com/zabbix/6.0/ubuntu noble main
```

##### ==ssh==
Создание ключ:
```
ssh-keygen -t rsa
```

Скопировать ключ:
```
ssh-copy-id -i <путь для ключа *.pub> <user>@<remote ip>
```

Проксирование трафика:

```
ssh -J ubuntu@<открытый ip> ubuntu-test@<ip сервера где то внутри локальной сети>
```
##### **==Переменные окружения==**
Вывести все переменные окружения
```
printenv
```

Вывести список путей в переменной $PATH
```
echo $PATH
```

Добавить новый путь в переменную окружения $PATH
```
export PATH=<путь>:$PATH
```
```
echo $PATH
export PATH=/home/kvl/pycharm/bin:$PATH
echo $PATH
```

Добавить новый путь для конкретного пользователя
```
vim ~/.bashrc
и добавить в конец файла строку:
export PATH=/home/kvl/pycharm/bin:$PATH
применить настройки немендленно
source ~/.bashrc
```

Добавить новый путь для всей системы
```
vim /etc/profile
и добавить в конец файла строку:
export PATH=/home/kvl/pycharm/bin:$PATH
применить настройки немендленно
source ~/.bashrc
```
##### ***==Архивы==***
Создать архив:
```
tar -cvf archive.tar /path/to/files
tar -czf archive.tar.gz /path/to/files
tar -xvf archive.tar -С <path to unrar>
tar -xzf archive.tar.gz
```

> [!NOTE] Ключи
> -с : создать
> -x : распаковать
> -z : сжать (распаковать) с помощью gzip
> -v : выводить процесс
> -f : имя архива
> -C : путь куда распаковать

```
gzip file.txt      (упаковать файл в file.txt.gz, оригинал удаляется)
gzip -k file.txt   (упаковать файл в file.txt.gz и сохранить оригинал)
gunzip file.txt.gz (распаковать)
```
##### **==Вывод информации==**

*Команда **printf**: эта команда была создана для замены всем знакомой команды echo.*

```
printf '%b\n' 'Ваш,\nАлексей Дмитриев'
```

> [!NOTE] Результат:
> Ваш,
> Алексей Дмитриев
> *==т.е. %b понимает управляющие символы, такие как перенос строки==*
 
 ```
printf '%s\n' 'Ваш,\nАлексей Дмитриев'
```
> [!NOTE] Результат:
> Ваш,\nАлексей Дмитриев
> *==т.е. %s не понимает управляющие символы, такие как перенос строки для неё это просто строка==*

 ```
printf '\n│ %-16b │ %-16b │\n' '1 sputnik nii tp' 'test20'
```
> [!NOTE] Результат:
> 
│ 1 sputnik nii tp │ test20 
> 
> *==т.е. %-16b : 16 символов между блоками и выравнивание выполняется по левому краю (знак минус)==* 
> **одновременная работа с кириллицей и английскими буквами не работает как надо, или вообще не работает с кириллицей**

*Команда **tee**: эта команда позволяет перенаправлять вывод информации одновременно как в файл  так и на экран.*

```
cat /var/log/auth.log | tee log.tmp
```

*Стандартный вывод команды ls -l будет показан на дисплее и добавлен в конец файла file.txt*

```
ls -l | tee -a file.txt
```

##### **==Вспомогательные команды:==**

`tr [:lower:] [:upper:]` - перевод из нижнего регистра в верхний

[Ссылка на статью №1: ](https://aidalinux.ru/w/Printf)
[Ссылка на статью №2:](https://phoenixnap.com/kb/bash-printf)

