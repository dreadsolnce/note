## Параметры службы systemd-timesyncd

sudo nano /etc/systemd/timesyncd.conf


> [!NOTE] Title
> - **NTP** — укажите 1 или несколько ntp серверов. Если хотите указать несколько серверов, разделяйте их пробелами;
> - **FallbackNTP** — укажите 1 или несколько резервных ntp серверов;
> - **RootDistanceMaxSec** — максимальное время в секундах, за которое пакет от сервера эталонного времени должен доходить до сервера к которому мы подлкючены;
> - **PollIntervalMinSec** и **PollIntervalMaxSec** — минимальный и максимальный интервалы синхронизаций времени. Вначале используется минимальный интервал, а затем он увеличивается если система видит что локальное время со временем ntp-сервера не расходится.Contents

![[Screenshot 2025-04-21 150340.png]]
Интервал синхронизации (34min 8s) использовался последний раз. То-есть служба синхронизации времени **systemd-timesyncd.service** будет запускаться и останавливаться сейчас примерно раз в 34 минуты.

## Настройка в качестве клиента

#### *Используя службу systemd-timesyncd*

> [!important] **Внимание**
> <h6>При настройке если это виртуальная машина (vmware) отключить синхронизацию с хостом ESXi <br>(хостовая машина на которой развернуто ПО Для управления Виртуальными машинами )</h6>
> <p>В виртуальной машине с ОС Linux если в ней установлен пакет vmvware-tools выполнить комманду:</p>
> <p>sudo vmware-toolbox-cmd timesync disable</p>

![[Screenshot 2025-04-23 100018.png]]


> [!NOTE] Описание
> Служба timesyncd предлагается в качестве современной "легковесной" замены ntp. Она более проста, интегрирована в ОС, но несколько ограничена в возможностях.
> Служба timesyncd **не может выполнять функции сервера**, это исключительно клиентская служба.
> В Astra Linux Special Edition 1.8 служба представлен отдельным пакетом systemd-timesyncd

***Для использования timesyncd в первую очередь необходимо полностью удалить пакеты chrony, ntp и openntpd (если они были установлены):***

sudo apt purge chrony  
sudo apt purge ntp  
sudo apt purge openntpd

***Прописать сервера врмени:***

sudo vim /etc/systemd/timesyncd.conf

> [!NOTE] Опции в конфигурационном файле
> - NTP= разделённый пробелами основной список имён NTP-серверов. Объединяется со списком полученных от службы systemd-networkd. По умолчанию список пустой.  
> - FallbackNTP= разделённый пробелами список имён резервных NTP-серверов. 
> 
> TIMESYNCD перебирает по очереди все серверы из основного списка, и, если не удалось связаться ни с одним из серверов, обращается к серверам из резервного списка.

***Запустить службу и добавить в автозагрузку:***
sudo systemctl start systemd-timesyncd
sudo systemctl enable systemd-timesyncd

***Проверка состояния службы :***
systemctl status systemd-timesyncd
sudo timedatectl status
timedatectl show-timysync
timedatectl show-timesync --all


> [!tip] Описание
> <p>При правильной настройке параметр **PollIntervalUSec** должен постепенно увеличиваться и дойти до значения **PollIntervalMaxUSec** </p>
> <p>это означает что время имеющееся на клиенте одинаково со временем на сервере и потому время проверки увеличивается</p>
> <p>а также время должно быть одинаковым</p>
> 


![[Screenshot 2025-04-04 155920 1.png]]

![[Screenshot 2025-04-04 155931.png]]

![[Screenshot 2025-04-23 101247.png]]